<html>

<head>

<title>- ORDER -</title>
<style>
	.btn_cyan{background-color: cyan;}
	.btn_grn{background-color: lime;}
	img{height:200px; width:200px;  border: 1px solid black;}
</style>
</head>

<body>
<font color="lime" size="5" face="TechnicLite"> ORDER </font>
<button id="popup" class="btn_cyan" onClick='javascript: buka_popup();'>LIHAT DATA PESANAN DISINI</button>
<hr>

<b>Nama Pemesan</b>    <br><input id="namebox" type="text" required></input><br><br>

<table>
<tr>
<td><b>Projek</b></td>
<td><b>Jenis Proses</b></td>
<td><b>No. Batch</b></td>
</tr>
<tr>
<td><select id="probox" required onchange="optpro()">
    <option selected></option>
    <option value="ROTA">ROTA</option>
    <option value="nOPV2">nOPV2</option>
    <option id="proopt">Lainnya</option>  
    </select></td>
<td><select id="jnsbox" required onchange="optjns()">
    <option selected></option>
    <option value="Resusitasi">Resusitasi</option>
    <option value="Pasase 1">Pasase 1</option>
    <option value="Pasase 2">Pasase 2</option>
    <option value="Pasase 3">Pasase 3</option>
    <option value="Pasase 4">Pasase 4</option>
    <option value="Pasase 5">Pasase 5</option>
    <option value="Inokulasi">Inokulasi</option>
    <option value="Filtrasi Harvest">Filtrasi & Harvest</option>
    <option value="Formulasi Filling">Formulasi Filling</option>
    <option value="Media Fill">Media Fill</option>
    <option value="Pembuatan Media">Pembuatan Media</option>
    <option value="Placebo">Placebo</option>
    <option id="jnsopt">Lainnya</option>
    </select></td>
<td><input id="btcbox" type="text" required></input></td>
</tr>
</table>
<br>

<b>Tanggal Proses</b>  <br><input id="tglbox" type="date" placeholder="dd/mm/yyyy" required></input><br><br>
<b>Pesanan </b>        <br><textarea cols="40" rows="10" id="ordbox" placeholder="Silahkan isi pesanan Anda" required></textarea> <br><br>
<b>Upload Gambar</b>   <label id="UpProg"></label> <br>
<img id="myimg"> <br>
<button id="select">Select Image</button>
<button id="upload">Upload Image</button>
<br><br>

<button id="order" class="btn_grn">ORDER !!!</button>

<hr>
&copy;Rezky Samudra Menthana
<label id="tme"></label>
<label id="inv"></label>

<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-storage.js"></script>
<script>
   var firebaseConfig = {
    apiKey: "AIzaSyDo1nF4abKQ3AlWMK-HaA4qNL4elGw2ESA",
    authDomain: "orderfirebasejs.firebaseapp.com",
    databaseURL: "https://orderfirebasejs-default-rtdb.firebaseio.com",
    projectId: "orderfirebasejs",
    storageBucket: "orderfirebasejs.appspot.com",
    messagingSenderId: "350540365610",
    appId: "1:350540365610:web:b6cf767714c9d71fb42853"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  //--------------------------------------Ready Data-------------------------------------------------//
function optpro() {if (document.getElementById("proopt").selected) {runPopup1();}}
function optjns() {if (document.getElementById("jnsopt").selected) {runPopup();} }

function runPopup1(){
    var respond = prompt("Projek Lainnya: ");
    if(respond != "")
    {
    select = document.getElementById('probox');
    var opts = document.getElementById('proopt');
    opts.value = respond;
    opts.innerHTML = respond;
    select.appendChild(opts);
    }
    else
    {
      window.alert("ISI DATA");
    }
    }

function runPopup(){
    var respond = prompt("Jenis Proses Lainnya: ");
    if(respond != "")
    {
    select = document.getElementById('jnsbox');
    var opt = document.getElementById('jnsopt');
    opt.value = respond;
    opt.innerHTML = respond;
    select.appendChild(opt);
    }
    else
    {
      window.alert("ISI DATA");
    }
    }


var nameV, proV, tglV, jnsV, btcV, ordV, tglOrdV, invV;
  function Ready(){
    nameV = document.getElementById('namebox').value;
    proV = document.getElementById('probox').value;
    tglV = document.getElementById('tglbox').value;
    jnsV = document.getElementById('jnsbox').value;
    btcV = document.getElementById('btcbox').value;
    ordV = document.getElementById('ordbox').value;
    tglOrdV = document.getElementById('tme').value;
    invV = document.getElementById('inv').value;
  }
  
//--------------------------------------Insert Proses----------------------------------------------//
document.getElementById('order').onclick = function(){  
  Ready();
if (nameV !="" && proV!="" && tglV!="" && jnsV!="" && btcV!="" && ordV!=""){
  alert("Thanks for your order !!!");
  firebase.database().ref(invV).update({
  Nama: nameV,
  Projek: proV,
  Tanggal_Proses: tglV,
  Jenis_Proses: jnsV,
  Batch: btcV,
  Status: "Pesanan Baru",
  Pesanan: ordV,
  Tgl_OrdDlv: tglOrdV,
  Invoice: invV,
  Catatan: "-" ,
  });
  }
else { 
alert("HARAP ISI SEMUA DATA");   
};
  }

//--------------------------------------Data Waktu----------------------------------------------//
arrbulan = ["01","02","03","04","05","06","07","08","09","10","11","12"];
date = new Date();
tanggal = date.getDate();
bulan = date.getMonth();
tahun = date.getFullYear();
jam = date.getHours();
menit = date.getMinutes();
document.getElementById("tme").value = tanggal+"-"+arrbulan[bulan]+"-"+tahun+"  "+jam+":"+menit;


//--------------------------------------Data Invoice----------------------------------------------//
function maketextnumber(n) {
    for (var r = ["A", "B", "C", "D", "E", "F",
 "G", "H", "I",  "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W",
 "X", "Y", "Z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"],
 e = n, t = new Array, a = 0; a <= e - 1; a++) {
        t[a] = r[parseInt(Math.random() * r.length)];
        t = t;
        randomtextnumber = t.join("")
    }
}
document.getElementById("inv").value = "ORD" + (50-arrbulan[bulan]) + "" + (100-tanggal) + "" + (75-jam) + (maketextnumber(4), randomtextnumber);



//-----------------------------VARIABLES-------------------------//
        var ImgName, ImgUrl;
        var files = [];
        var reader;
        

//-------------------------Selection Proses----------------------//
        document.getElementById('select').onclick = function(e){
            var input = document.createElement('input');
            input.type= 'file';

            input.onchange = e => {
                files = e.target.files;
                reader = new FileReader();
                reader.onload = function(){
                    document.getElementById("myimg").src = reader.result;
                }
                reader.readAsDataURL(files[0]);
            }
            input.click();
        }

//-------------------------Upload Proses----------------------//
//-------------------------Upload Picture to Storage----------------------//
        document.getElementById('upload').onclick = function(){
        Ready();
            var uploadTask = firebase.storage().ref('Images/'+invV+".jpg").put(files[0]);
            uploadTask.on('state_changed', function(snapshot){
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                document.getElementById('UpProg').innerHTML = 'upload'+progress+'%';
            },
//-------------------------Error Handling----------------------//
            function(error){
                alert('error in saving image');
            },
//-------------------------Submit image link to database----------------------//
            function(){
                uploadTask.snapshot.ref.getDownloadURL().then(function(url){
                    ImgUrl = url;
                

                    firebase.database().ref(invV).set({
                        Link: ImgUrl,
                    });
                alert('image added successfully');
                });
        });
    }

 
function buka_popup(){
 window.open('DatabaseOrdDesk.htm');
}
</script>
</body>

</html>
